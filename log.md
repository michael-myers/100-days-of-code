# 100 Days Of Code - Log

### Day 1: June 28, 2024 (Friday)

**Hour 1 Progress**: Browsed the osquery issues list. Started with macOS. Wish I could work on [8220](https://github.com/osquery/osquery/issues/8220) but this is a TCC rabbit hole issue, which means testing entitlements and re-signing the executables, which I can't do. Location Services is apparently now the only way a macOS application can request SSID information. I get it -- that's a proxy for your location, and ought to be private. But how would the osquery daemon even prompt the user? It would have to start pre-authorized with the entitlement. https://developer.apple.com/forums/thread/739712#768907022 Ok so is osqueryd a launch "agent" or a "daemon"? I left a comment in the issue.

**Hour 2 Progress**: All right how do I build osquery again? [Here](https://osquery.readthedocs.io/en/latest/development/building/#macos). The first build took >2 hours and >100% of my laptop battery. LOL when this 1-hour-a-day coding challenge was envisioned they were not even thinking about compiled languages. Oh hey, issue [7750](https://github.com/osquery/osquery/issues/7750) looks easy, just remove an old table column alias. But wait, this column is part of the schema for every OS not just macOS. "total_size" is intended to be "Total virtual memory size" of a process. Is osquery/specs/processes.table accurate when it says implementation("system/processes@genProcesses")? Because it's clearly in three places: osquery/tables/system/windows/processes.cpp and osquery/tables/system/linux/processes.cpp and osquery/tables/system/darwin/processes.cpp. The relevant field seems to be generated by [genProcResourceUsage()](https://github.com/osquery/osquery/blob/ca14540bd01ce792b1fc43add8502059ac71835c/osquery/tables/system/darwin/processes.cpp#L450). It originates from the ri_phys_footprint field of a rusage_info_v2 struct returned by the proc_pid_rusage() API of [libproc](https://opensource.apple.com/source/xnu/xnu-2422.1.72/libsyscall/wrappers/libproc/libproc.h.auto.html). "This header file contains private interfaces to obtain process information." lmao osquery is not supposed to do this. Is it a supported API? People seem to keep using it https://stackoverflow.com/questions/66328149/the-cpu-time-obtained-by-proc-pid-rusage-does-not-meet-expectations-on-the-macos From investigating, it looks like everyone uses it and that there are no public interface alternatives. Even the Apple representative acknowledges the problems with this: https://developer.apple.com/forums/thread/46963

Whereas, on Linux, it is the `total_size` field of a SimpleProcStat struct, which is something filled with its constructor, it's defined in osquery. Output from string parsing /proc/<pid>/status. That's it. In procfs it's `VmSize`.

**Hour 3 Progress**: I wonder if the osquery processes table is actually measuring physical RAM usage or virtual memory size? Activity Monitor should be a cross-check. Also `ps -e -o pid,rss,vsz` or `ps -xm -o %mem,rss,comm -p $(pgrep MyAppName)` and `vm_stat` commands. Also `vmmap --summary "$pid"` But there is now Physical Memory, Wired Memory, and Compressed Memory??

    UGH, well one thing I just learned about memory is that Safari will lose the text I'm drafting in a long GitHub issue comment!

**Thoughts:** Directions state to use Twitter and subscribe on Substack, I won't be doing that. There's a Slack, I'll check that out...oh no the invite link is dead and they expect me to use Twitter to ask for a new one. Guess I'll do this on my own. I'm also making it my own, because as it was originally envisioned this whole thing has the smell of Learn to Code Bootcamp JavaScript in 28 Days How to Land a Career in Tech self-help.

    One of the fundamental problems with osquery is having to maintain something with so much code that is so close to the operating system that OS updates are constantly creating breaking changes. And there are multiple operating systems it supports.

**Link to work:** I will be working here on  [osquery](https://github.com/michael-myers/osquery)
